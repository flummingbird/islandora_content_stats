<?php
require_once dirname(__FILE__) . '/includes/queries.inc';

/**
 * Implements hook_menu().
 */
function islandora_content_stats_menu() {
  $items = array();
  $items['admin/islandora/tools/content_stats'] = array(
    'title' => 'Content Statistics Admin',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('islandora_content_stats_admin_form',1),
    'access arguments' => array('administer site configuration'),
    'file' => 'includes/admin.form.inc',
  );
  $items['admin/reports/content_stats'] = array(
    'title' => 'Content Statistics Report',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('islandora_content_stats_table_form', 1),
    'access arguments' => array('administer site configuration'),
    'file' => 'includes/reports.form.inc',
  );
  return $items;
}


//todo (later)

//display all query results on demand
//- as a block -
///**
// * Implements hook_block_info().
// */
//function current_posts_block_info() {
//  $blocks['current_posts'] = array(
//    // The name that will appear in the block list.
//    'info' => t('Current posts'),
//    // Default setting.
//    'cache' => DRUPAL_CACHE_PER_ROLE,
//  );
//  return $blocks;
//}
islandora_content_stats_post_collection_stats();
function islandora_content_stats_post_collection_stats(){
  if(strpos(current_path(),'collection')){
    $str =current_path();
    $coll = str_replace('islandora/object/','',$str);
    islandora_content_stats_page_cmodels($coll);
  }
}

function islandora_content_stats_preprocess_html(&$variables){
  $node = get_menu_object();
  dpm($node);
}

function check_path(){
  $one_of_these = update_namespace_prefixes_cache();
      if(in_array(str_replace('/','',request_uri()), $one_of_these)){
        return true;
      }
}

islandora_content_stats_post_institution_stats();
function islandora_content_stats_post_institution_stats(){
  if(!preg_match("/([\/]\w+[\/]\w+)/", request_uri())){
    if(check_path()){
      islandora_content_stats_page_cmodels(str_replace('/','',request_uri()));
    }
  }
}
